{% load static %}

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>P4 Drawing</title>

    <link rel="stylesheet" type="text/css" href="{% static 'draw/vendor/bootstrap/css/bootstrap.min.css' %}">
    <script type="text/javascript" src="{% static 'draw/vendor/jquery/jquery-3.3.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'draw/vendor/paper/paper-full.min.js' %}"></script>
  <script type="text/javascript" src="https://cdn.rawgit.com/alexgibson/shake.js/master/shake.js"></script>
  

    <style type="text/css">
    </style>

</head>
<body>
    <!-- You may change the dimensions of this canvas -->
    <canvas id="myCanvas" width="750px" height="750px"></canvas>
</body>
<script>
  var canvas = document.getElementById('myCanvas');
  paper.setup(canvas);
  var tool = new paper.Tool();
  
  paper.view.draw();
  
  // getting the URL (you may want to use for Exercise 3)
    var url = window.location.href;
  
  
  //testing items to see how to get the legos to work
  
  
  //creating items 2 rectangles, basic shapes in paperJS must be made as path items, eg paper.Path.Rectangle(....)
  var pointA = new paper.Point(200,100);
  var pointB = new paper.Point(300,300); 
  var sizeTEST = new paper.Size(200,100);
  var rect1 = new paper.Path.Rectangle(pointA, sizeTEST);
  var rect2 = new paper.Path.Rectangle(pointB, sizeTEST);
  rect2.fillColor = 'blue';
  rect1.fillColor = 'red';
  
  //adding them to an array, all legos will pushed to a global array on intialization
  var testArray = [rect1, rect2];
  
  
  //empty variable, will get assigned to on click.
  var currentSelection = new paper.Path();
  console.log(currentSelection);
  
  paper.view.draw();
  
  
  
  var segment, path;
  var movePath = false;
  
  var hitOptions = {
	segments: true,
	stroke: true,
	fill: true,
	tolerance: 5
  };
  
  
  //picks up any paper path item it clicks on;
  tool.onMouseDown = function(event) {
    
    segment = path = null;
    var hitResult = paper.project.hitTest(event.point, hitOptions);
    
    if (!hitResult) {
      return;
    }
    
    if (event.modifiers.shift) {
      if (hitResult.type == 'segment') {
        hitResult.segment.remove();
      }
    }
    
    if (hitResult) {
		path = hitResult.item;
		if (hitResult.type == 'segment') {
			segment = hitResult.segment;
		} else if (hitResult.type == 'stroke') {
			var location = hitResult.location;
			segment = path.insert(location.index + 1, event.point);
			path.smooth();
		}
	}
    
    if (hitResult) {
      path = hitResult.item;
      if (hitResult.type == 'segment') {
        segment = hitResult.segment;
      }
      else if (hitResult.type == 'stoke') { //this should be the hit result.segment deal
        var location = hitResult.location;
        segment = path.insert(location.index+1, event.point);
        path.smooth();
      }
      
      movePath = hitResult.type == 'fill';
      if (movePath) {
        project.activeLayer.addChild(hitResult.item);
      }
    }
    
    
    
    
    console.log(hitResult.type);
    
   
  }
  
  
  
  
  
  /*

    // setting up the canvas and one paper tool
    var canvas = document.getElementById('myCanvas');
    paper.setup(canvas);
    var tool = new paper.Tool();
  
  var count = 0;

    // getting the URL (you may want to use for Exercise 3)
    var url = window.location.href;
  console.log(url);

  
    var socket = new WebSocket('wss://p3-websockets-dpayne5-dpayne589733.codeanyapp.com/ws/draw');
    var colors = ['black', 'green', 'red', 'pink', 'orange', 'purple', 'magenta', 'cyan', 'blue', 'gray'];
    
  var publicPath = new paper.Path();
  var isSmall = false;
  
  
  //array of paths, for the multiple users, 
  var peopleArray = [];
  
  for (i = 0; i < colors.length; i++) {
    peopleArray.push(new paper.Path());
  }
  
  var randomIndex = Math.floor((Math.random() * 10000) % colors.length);
    //publicPath.strokeColor = colors[randomIndex];
  
  
  //1C implementation here
  
  
  
  if (url == "https://p3-websockets-dpayne5-dpayne589733.codeanyapp.com/draw/?size-small") {
    console.log("small url")
    isSmall = true;
    
    for (i=0; i< peopleArray.length; i++) {
      if (i != randomIndex) {
        console.log("setting path visibility to false");
        peopleArray[i].visible = false;
      }
    }
    
    
  }
  
  tool.onMouseDown = function(event) {
    
    peopleArray[randomIndex] = new paper.Path();
    
    //here have to make another socket send to flag if the thing is small
    
    var oneCdata = "[" + -2 + "," + randomIndex + "]";
    console.log(oneCdata);
    
    socket.send(oneCdata)
    
  }
  
  tool.onMouseDrag = function(event) {
   // console.log("dragging");
    
      var d = JSON.stringify(event.point);
    //console.log(d);
      d = d.substring(0, d.length -1);
      d = d + ',"' + colors[randomIndex] + '",' + randomIndex +']';
    console.log(d);
    
      socket.send(d);
    

  }
  
  tool.onMouseUp = function(event) {
    //publicPath = new paper.Path();
    //publicPath.strokeColor = 'white';
    
    peopleArray[randomIndex] = new paper.Path();
    
    var passFlag = "["+ randomIndex + ',' + -1 + "]";
    console.log(passFlag);
    socket.send(passFlag);
    
    //on mouse Up send a thing to the other arrays, and make sure the new piece is cleared.
    
  }
  
    socket.onmessage = function(data) {
      var c = JSON.parse(data.data);
      
      console.log(count);
      console.log(data.data);
      
      
      if (c[0] == -2) {
        if (isSmall && c[1] != randomIndex) {
          peopleArray[c[1]].visible = false;
          
        }
      }
      
      if (c[1] == -1) {
        peopleArray[c[0]] = new paper.Path();
        return;
      }
      
      //console.log(publicPath.segments);
      
      if (count == 0) {
        peopleArray[c[4]] = new paper.Path();
        peopleArray[c[4]].strokeColor = 'white';
        
        
      }
      else if (count == 1) {
        peopleArray[c[4]].removeSegment(peopleArray[c[4]].segments.length -1);
      }
      else if (count > 1) {
        //var c = JSON.parse(data.data);
      console.log(c);
        console.log(c[4], c[3]);
      peopleArray[c[4]].strokeColor = c[3];
      peopleArray[c[4]].add(new paper.Point(c[1],c[2]));
        
        
        console.log(count);
        
      }
      
      
      count = count + 1;
      paper.view.draw();
      
      
    }
    */

</script>
</html>
