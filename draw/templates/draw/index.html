{% load static %}

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>P4 Drawing</title>

    <link rel="stylesheet" type="text/css" href="{% static 'draw/vendor/bootstrap/css/bootstrap.min.css' %}">
    <script type="text/javascript" src="{% static 'draw/vendor/jquery/jquery-3.3.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'draw/vendor/paper/paper-full.min.js' %}"></script>
  <script type="text/javascript" src="https://cdn.rawgit.com/alexgibson/shake.js/master/shake.js"></script>
  

    <style type="text/css">
      
      /* Body element, flex display, justify content center, to center all following content*/
      body {
        display: flex;
        justify-content: center;
        flex-direction: column;
        
        
      }
      #myCanvas {
        border: 2px solid black;
        height: 700px;
        width: 95%;
        margin: 0 auto;
      }
      
      /* This will be the bar to choose legos to drop onto the screen. */
      .legoBAR {
        margin-top: 20px;
        border: 2px solid blue;
        width: 95%;
        height:200px;
        margin-left: 30px;
        
        display: flex;
        justify-content: space-around;
      }
      
      .legoItem {
        height: 125px;
        width: 125px;
        margin-top:35px;
        display: flex;
        color: gold;
        flex-direction: column;
        justify-content: space-between;
        border: 2px solid purple;
        
        
      }
      
      .buttonContainer {
        border: 2px solid red;
        margin: 0 auto;
        
        width: 95%;
        display: flex;
        flex-direction: row;
        justify-content:space-around;
        margin-top: 20px;
      }
      
      .imageContainer {
        border: 2px solid green;
        margin-left: 80px;
        width: 80%;
        display: flex;
        margin-top: 10px;
        justify-content: space-between;
      }
      
      .imageForClick {
        background-color: black;
        color: white;
      }
      
      .largeImage {
        width:175px;
        height: 30px;
      }
      
      .mediumImage {
        width: 125px;
        height: 30px;
      }
      
      .smallImage {
        width: 75px;
        height:30px;
        
      }
      
      .largeSimage {
        height: 100px;
        width: 100px;
        
      }
      
      .smallSimage {
        height:50px;
        width: 50px;
        
      }
      
      
      
      
      
    </style>

</head>
<body>
    <!-- You may change the dimensions of this canvas -->
    <canvas id="myCanvas"></canvas>
  
  <!--The "toolbar" which holds the different types of legos, div classes currently have placeholders,
        they will have buttons eventually which create new paper objects maybe in the bottom corner, and an undo button-->
  
  <div class="buttonContainer">
    <button onclick="createLargePiece()" class="largepiece">
         Large LEGO
      </button>
    <button onclick="createMidPiece()" class="largepiece">
         Medium LEGO
      </button>
    <button onclick="createSmallPiece()" class="largepiece">
         Small LEGO
      </button>
    <button onclick="createLargeSquare()" class="largepiece">
         Large Square
      </button>
    <button onclick="createSmallSquare()" class="largepiece">
         Small Square
      </button>
    <button onclick="undo()">
         Undo
      </button>
    
  </div>
  <div class="imageContainer">
    
    
    <div class="largeImage imageForClick"></div>
    <div class="mediumImage imageForClick"></div>
    <div class="smallImage imageForClick"></div>
    <div class="largeSimage imageForClick"></div>
    <div class="smallSimage imageForClick"></div>
    
    
    
  </div>
  
</body>
<script>
  
  
  function createLargePiece() {
    console.log("bobby");
  }
  
  
  function createSmallPiece() {
    //socket send here
  }
  
  function createMidPiece() {
    //
  }
  
  function createLargeSquare() {
    //
  }
  
  function createSmallSquare() {
    
  }
  
  function undo() {
    //delete last block made
  }
  
  var canvas = document.getElementById('myCanvas');
  paper.setup(canvas);
  var tool = new paper.Tool();
  
  paper.view.draw();
  
  // getting the URL (you may want to use for Exercise 3)
    var url = window.location.href;
  
  
  //testing items to see how to get the legos to work
  
  
  //creating items 2 rectangles, basic shapes in paperJS must be made as path items, eg paper.Path.Rectangle(....)
  
  /*
  var pointA = new paper.Point(200,100);
  var pointB = new paper.Point(300,300); 
  var sizeTEST = new paper.Size(200,100);
  var rect1 = new paper.Path.Rectangle(pointA, sizeTEST);
  var rect2 = new paper.Path.Rectangle(pointB, sizeTEST);
  */
  
  
  
  //Pieces to use, 
  var longPiece = new paper.Path.Rectangle(new paper.Point(200,300), new paper.Size(400,50));
  var midPiece = new paper.Path.Rectangle(new paper.Point(200,100), new paper.Size(200,50));
  var shortPiece = new paper.Path.Rectangle(new paper.Point(200,200), new paper.Size(100,50));
  var largeSquare = new paper.Path.Rectangle(new paper.Point(400,400), new paper.Size(200,200));
  var smallSquare = new paper.Path.Rectangle(new paper.Point(500,400), new paper.Size(200,200));
  
  
  //commented out below is an attempt at a half circle/cap. Going to come back to it.
  /* 
  
  var startPointArcOne = new paper.Point(100,100);
  var endPointArcOne = new paper.Point(0,100);
  var midPointArcOne = new paper.Point(40,50);
  
  var arcRight = new paper.Path.Arc(startPointArcOne, midPointArcOne, endPointArcOne);
  arcRight.fillColor = 'black';
  
  */
  
  
  
  
  
  
  
  //differentiating colors to tell objects apart
  
  longPiece.fillColor = 'red';
  midPiece.fillColor = 'blue';
  shortPiece.fillColor = 'black';
  largeSquare.fillColor = 'orange';
  smallSquare.fillColor = 'magenta';
  
  //adding them to an array, all legos will pushed to a global array on intialization
  //var testArray = [loing];
  
  //hardcoded more lego items, to go along with rect 1 and rect 2
  
  
  //empty variable, will get assigned to on click.
  var currentSelection = new paper.Path();
  console.log(currentSelection);
  
  paper.view.draw();
  
  
  
  var segment, path;
  var movePath = false;
  
  var hitOptions = {
	segments: true,
	stroke: true,
	fill: true,
	tolerance: 5
  };
  
  
  //picks up any paper path item it clicks on;
  tool.onMouseDown = function(event) {
    
    segment = path = null;
    var hitResult = paper.project.hitTest(event.point, hitOptions);
    
    if (!hitResult) {
      return;
    }
    
    if (event.modifiers.shift) {
      if (hitResult.type == 'segment') {
        hitResult.segment.remove();
      }
    }
    
    if (hitResult) {
		path = hitResult.item;
		if (hitResult.type == 'segment') {
			segment = hitResult.segment;
		} else if (hitResult.type == 'stroke') {
			var location = hitResult.location;
			segment = path.insert(location.index + 1, event.point);
			path.smooth();
		}
	}
    
    if (hitResult) {
      path = hitResult.item;
      if (hitResult.type == 'segment') {
        segment = hitResult.segment;
      }
      else if (hitResult.type == 'stoke') { //this should be the hit result.segment deal
        var location = hitResult.location;
        segment = path.insert(location.index+1, event.point);
        path.smooth();
      }
      
      movePath = hitResult.type == 'fill';
      if (movePath) {
        paper.project.activeLayer.addChild(hitResult.item);
      }
    }  
    console.log(hitResult.type);
  }
  
  
  //
  tool.onMouseDrag = function(event) {
    if (segment) {
      segment.point += event.delta;
      path.smooth();
    }
    else if (path) {
      path.position = event.point;
    }
  }
  


  
  
  
  
  
  /*

    // setting up the canvas and one paper tool
    var canvas = document.getElementById('myCanvas');
    paper.setup(canvas);
    var tool = new paper.Tool();
  
  var count = 0;

    // getting the URL (you may want to use for Exercise 3)
    var url = window.location.href;
  console.log(url);

  
    var socket = new WebSocket('wss://p3-websockets-dpayne5-dpayne589733.codeanyapp.com/ws/draw');
    var colors = ['black', 'green', 'red', 'pink', 'orange', 'purple', 'magenta', 'cyan', 'blue', 'gray'];
    
  var publicPath = new paper.Path();
  var isSmall = false;
  
  
  //array of paths, for the multiple users, 
  var peopleArray = [];
  
  for (i = 0; i < colors.length; i++) {
    peopleArray.push(new paper.Path());
  }
  
  var randomIndex = Math.floor((Math.random() * 10000) % colors.length);
    //publicPath.strokeColor = colors[randomIndex];
  
  
  //1C implementation here
  
  
  
  if (url == "https://p3-websockets-dpayne5-dpayne589733.codeanyapp.com/draw/?size-small") {
    console.log("small url")
    isSmall = true;
    
    for (i=0; i< peopleArray.length; i++) {
      if (i != randomIndex) {
        console.log("setting path visibility to false");
        peopleArray[i].visible = false;
      }
    }
    
    
  }
  
  tool.onMouseDown = function(event) {
    
    peopleArray[randomIndex] = new paper.Path();
    
    //here have to make another socket send to flag if the thing is small
    
    var oneCdata = "[" + -2 + "," + randomIndex + "]";
    console.log(oneCdata);
    
    socket.send(oneCdata)
    
  }
  
  tool.onMouseDrag = function(event) {
   // console.log("dragging");
    
      var d = JSON.stringify(event.point);
    //console.log(d);
      d = d.substring(0, d.length -1);
      d = d + ',"' + colors[randomIndex] + '",' + randomIndex +']';
    console.log(d);
    
      socket.send(d);
    

  }
  
  tool.onMouseUp = function(event) {
    //publicPath = new paper.Path();
    //publicPath.strokeColor = 'white';
    
    peopleArray[randomIndex] = new paper.Path();
    
    var passFlag = "["+ randomIndex + ',' + -1 + "]";
    console.log(passFlag);
    socket.send(passFlag);
    
    //on mouse Up send a thing to the other arrays, and make sure the new piece is cleared.
    
  }
  
    socket.onmessage = function(data) {
      var c = JSON.parse(data.data);
      
      console.log(count);
      console.log(data.data);
      
      
      if (c[0] == -2) {
        if (isSmall && c[1] != randomIndex) {
          peopleArray[c[1]].visible = false;
          
        }
      }
      
      if (c[1] == -1) {
        peopleArray[c[0]] = new paper.Path();
        return;
      }
      
      //console.log(publicPath.segments);
      
      if (count == 0) {
        peopleArray[c[4]] = new paper.Path();
        peopleArray[c[4]].strokeColor = 'white';
        
        
      }
      else if (count == 1) {
        peopleArray[c[4]].removeSegment(peopleArray[c[4]].segments.length -1);
      }
      else if (count > 1) {
        //var c = JSON.parse(data.data);
      console.log(c);
        console.log(c[4], c[3]);
      peopleArray[c[4]].strokeColor = c[3];
      peopleArray[c[4]].add(new paper.Point(c[1],c[2]));
        
        
        console.log(count);
        
      }
      
      
      count = count + 1;
      paper.view.draw();
      
      
    }
    */

</script>
</html>
